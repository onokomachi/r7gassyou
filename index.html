<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°çƒã®é¼“å‹• - æ­Œå”±ã‚¬ã‚¤ãƒ‰</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; background-color: #f7fafc; }
        .part-button.active-SOPRANO { background-color: #f87171; color: white; transform: scale(1.05); }
        .part-button.active-ALTO { background-color: #fbbf24; color: white; transform: scale(1.05); }
        .part-button.active-TENOR { background-color: #34d399; color: white; transform: scale(1.05); }
        .lyric-word { display: inline-block; transition: color 0.1s ease-in, transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94); color: #9ca3af; }
        .lyric-word.highlight { color: #111827; transform: translateY(-1px) scale(1.03); font-weight: 800; }
        .lyric-word.rest { color: #d1d5db; font-style: italic; }
        #play-pause-btn svg { width: 2rem; height: 2rem; transition: transform 0.1s ease-in-out; }
        #play-pause-btn:active svg { transform: scale(0.9); }
    </style>
    <script>
        tailwind.config = { theme: { extend: { colors: { 'primary-red': '#f87171', 'primary-yellow': '#fbbf24', 'primary-green': '#34d399' } } } }
    </script>
</head>
<body class="p-4 md:p-8 min-h-screen flex flex-col">

    <header class="text-center mb-6">
        <h1 class="text-3xl font-extrabold text-gray-800">ã€Œåœ°çƒã®é¼“å‹•ã€æ­Œå”±ã‚¬ã‚¤ãƒ‰ (ä¸‰éƒ¨åˆå”±ç‰ˆ)</h1>
        <p class="text-gray-500 text-sm mt-1">éŸ³æºã«åˆã‚ã›ã¦æ­Œè©ãŒè‡ªå‹•ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã‚Œã¾ã™</p>
    </header>

    <div class="max-w-4xl mx-auto w-full flex-grow">
        <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ -->
        <div class="bg-white p-4 rounded-xl shadow-lg mb-6 border border-gray-200">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-lg font-bold text-gray-700">ğŸ¹ ä¼´å¥ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h3>
                <button id="sync-toggle-btn" class="px-3 py-1 text-sm font-semibold rounded-full bg-green-500 text-white transition-colors">åŒæœŸ ON</button>
            </div>
            <div class="mb-4">
                <label for="audio-source-select" class="block text-sm font-medium text-gray-700 mb-1">ğŸµ éŸ³æºã‚’é¸æŠ</label>
                <select id="audio-source-select" class="w-full p-2 border border-gray-300 rounded-lg shadow-sm">
                    <option value="./MUSIC/1.mp3" selected>å…¨ä½“åˆå”± (ã‚¼ãƒ³ãƒ‘ãƒ¼)</option>
                    <option value="./MUSIC/2.mp3">ä¼´å¥ã®ã¿</option>
                    <option value="./MUSIC/3.mp3">ã‚½ãƒ—ãƒ©ãƒãƒ‘ãƒ¼ãƒˆ</option>
                    <option value="./MUSIC/4.mp3">ã‚¢ãƒ«ãƒˆãƒ‘ãƒ¼ãƒˆ</option>
                    <option value="./MUSIC/5.mp3">ãƒ†ãƒãƒ¼ãƒ«ãƒ‘ãƒ¼ãƒˆ</option>
                </select>
            </div>
            <audio id="chorus-audio" src="./MUSIC/1.mp3" preload="metadata"></audio>
            <div class="flex items-center space-x-4">
                <button id="play-pause-btn" class="p-2 bg-gray-500 hover:bg-gray-600 rounded-full text-white">
                    <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/></svg>
                    <svg id="pause-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z"/></svg>
                </button>
                <div class="flex-grow">
                    <input type="range" id="audio-slider" min="0" max="182" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span id="current-time">0:00</span>
                        <span id="duration">0:00</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="flex justify-center space-x-2 md:space-x-4 mb-6 p-3 bg-white rounded-xl shadow-lg">
            <button class="part-button px-4 py-2 rounded-full font-semibold text-sm transition-transform" data-part="SOPRANO">ã‚½ãƒ—ãƒ©ãƒ</button>
            <button class="part-button px-4 py-2 rounded-full font-semibold text-sm transition-transform" data-part="ALTO">ã‚¢ãƒ«ãƒˆ</button>
            <button class="part-button px-4 py-2 rounded-full font-semibold text-sm transition-transform" data-part="TENOR">ãƒ†ãƒŠãƒ¼</button>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-2xl">
            <div class="mb-4">
                <div id="progress-text" class="text-xs text-gray-600 mb-1 text-right">0/15</div>
                <div class="w-full bg-gray-200 rounded-full h-2"><div id="progress-bar" class="h-2 rounded-full transition-all duration-300" style="width: 0%"></div></div>
            </div>
            
            <div class="text-center mb-6 min-h-[100px] flex flex-col justify-center">
                <p id="measure-number" class="text-lg font-bold text-gray-500 mb-2">å°ç¯€: -</p>
                <h2 id="current-lyrics" class="text-4xl font-extrabold text-gray-900 leading-relaxed tracking-wide">ãƒ‘ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                <div id="dynamics-card" class="p-4 rounded-xl text-center border-2">
                    <p class="text-sm font-semibold mb-1">ã¤ã‚ˆã•</p>
                    <p id="current-dynamics-symbol" class="font-black transition-transform duration-300">-</p>
                    <p id="current-dynamics-meaning" class="text-lg font-medium">-</p>
                </div>
                <div class="p-4 rounded-xl text-center border">
                    <p class="text-sm font-semibold mb-1">ã¯ã‚„ã•ãƒ»è¡¨ç¾</p>
                    <p id="current-tempo-symbol" class="text-3xl font-bold">-</p>
                    <p id="current-tempo-meaning" class="text-lg font-medium">-</p>
                </div>
            </div>

            <div id="instruction-area" class="mt-8 p-4 rounded-xl border-2 border-dashed min-h-[100px] flex items-center justify-center">
                <p id="part-instruction" class="text-xl font-medium text-center">-</p>
            </div>

            <div class="mt-8 flex justify-between space-x-4">
                <button id="prev-btn" class="flex-1 px-6 py-3 bg-gray-300 text-gray-800 font-bold rounded-xl hover:bg-gray-400 transition disabled:opacity-50">&larr; å‰ã¸</button>
                <button id="next-btn" class="flex-1 px-6 py-3 text-white font-bold rounded-xl transition disabled:opacity-50">æ¬¡ã¸ &rarr;</button>
            </div>
        </div>
    </div>

    <footer class="mt-8 text-center text-xs text-gray-400">&copy; 2025 Interactive Chorus Guide Prototype</footer>

<script>
    // =================================================================
    // 1. ãƒ‡ãƒ¼ã‚¿æ§‹é€  (ãƒ‘ãƒ¼ãƒˆåˆ¥æ­Œè©ãƒ»æ™‚é–“è»¸ å®Œå…¨ä¿®æ­£ç‰ˆ)
    // =================================================================
    const MUSIC_GLOSSARY = {
        'p': { meaning: 'å¼±ã', size: 'text-6xl' }, 'mp': { meaning: 'ã‚„ã‚„å¼±ã', size: 'text-7xl' },
        'mf': { meaning: 'ã‚„ã‚„å¼·ã', size: 'text-8xl' }, 'f': { meaning: 'å¼·ã', size: 'text-9xl' },
        'fff': { meaning: 'ãã‚ã‚ã¦å¼·ã', size: 'text-9xl font-black' }, 'cresc.': { meaning: 'ã ã‚“ã ã‚“å¼·ã' },
        'dim.': { meaning: 'ã ã‚“ã ã‚“å¼±ã' }, 'rit.': { meaning: 'ã ã‚“ã ã‚“ã‚†ã£ãã‚Š' },
        'rall.': { meaning: 'ã ã‚“ã ã‚“ã‚†ã£ãã‚Š' }, 'accel.': { meaning: 'ã ã‚“ã ã‚“é€Ÿã' }, 'Maestoso': { meaning: 'è˜å³ã«' },
        'Tempo I': { meaning: 'ã‚‚ã¨ã®é€Ÿã•ã§' }, 'Un poco mosso': { meaning: 'å°‘ã—å‹•ãã‚’ã¤ã‘ã¦' },
        'rit. poco': { meaning: 'å°‘ã—ã ã‘ã‚†ã£ãã‚Š' }, 'Meno mosso': { meaning: 'ä»Šã¾ã§ã‚ˆã‚Šé…ã' },
        'A Tempo': { meaning: 'ã‚‚ã¨ã®é€Ÿã•ã§' }, 'Andante': { meaning: 'æ­©ãã‚ˆã†ãªé€Ÿã•ã§' },
        'Lento': { meaning: 'ã‚†ã‚‹ã‚„ã‹ã«' }, 'Espressivo': { meaning: 'è¡¨æƒ…è±Šã‹ã«' }
    };
    
    const CHORUS_DATA = [
        {
            measure: '1-4', dynamics: 'p', tempo: 'Tempo I',
            lyrics: {
                SOPRANO: [{ text: "èã“ãˆã¦ãã‚‹ã ã‚", time: 23.2 }, { text: "åœ°çƒã®é¼“å‹•ãŒ", time: 27.5 }],
                ALTO:    [{ text: "èã“ãˆã¦ãã‚‹ã ã‚", time: 23.2 }, { text: "åœ°çƒã®é¼“å‹•ãŒ", time: 27.5 }],
                TENOR:   [{ text: "èã“ãˆã¦ãã‚‹ã ã‚", time: 23.2 }, { text: "åœ°çƒã®é¼“å‹•ãŒ", time: 27.5 }]
            },
            SOPRANO: "å•ã„ã‹ã‘ã‚‹ã‚ˆã†ã«ã€**å„ªã—ãæ­Œã„å§‹ã‚**ã€ã€Œé¼“å‹•ãŒã€ã§å°‘ã—ã ã‘éŸ¿ãã‚’è†¨ã‚‰ã¾ã›ã‚‹ã€‚",
            ALTO: "ãƒªã‚ºãƒ ã‚’æ­£ç¢ºã«ã€ã—ã‹ã—ç¡¬ããªã‚‰ãªã„ã‚ˆã†ã«ã€‚ãƒ¡ãƒ­ãƒ‡ã‚£ã‚’æ”¯ãˆã‚‹é€æ˜ãªéŸ¿ãã‚’æ„è­˜ã€‚",
            TENOR: "ã€Œé¼“å‹•ãŒã€ã®**é«˜éŸ³éƒ¨ã‚’ä¸å¯§ã«**æ‰±ã„ã€å¼·å¼±è¨˜å·é€šã‚Šã«å¾ã€…ã«éŸ¿ãã‚’å‰ã«å‡ºã™ã€‚",
        },
        {
            measure: '5-8', dynamics: 'mf', tempo: 'Un poco mosso',
            lyrics: {
                SOPRANO: [{ text: "å¯„ã›ã¦ã¯è¿”ã™æ³¢", time: 32.8 }, { text: "ã¯ã‚‹ã‹ãªã‚‹æ™‚ã‚’è¶Šãˆ", time: 37.0 }],
                ALTO:    [{ text: "å¯„ã›ã¦ã¯è¿”ã™æ³¢", time: 32.8 }, { text: "ã¯ã‚‹ã‹ãªã‚‹æ™‚ã‚’è¶Šãˆ", time: 37.0 }],
                TENOR:   [{ text: "å¯„ã›ã¦ã¯è¿”ã™æ³¢", time: 32.8 }, { text: "ã¯ã‚‹ã‹ãªã‚‹æ™‚ã‚’è¶Šãˆ", time: 37.0 }]
            },
            SOPRANO: "æ³¢ã®å‹•ãã®ã‚ˆã†ã«ãƒ•ãƒ¬ãƒ¼ã‚ºã«æŠ‘æšã‚’ã¤ã‘ã‚‹ã€‚**ã€Œã¯ã‚‹ã‹ãªã‚‹ã€ã§å¼·ã**ã€æ¬¡ã«å‘ã‘ã¦ç››ã‚Šä¸Šã’ã‚‹ã€‚",
            ALTO: "éŸ³ã®è·³èºï¼ˆã‚¸ãƒ£ãƒ³ãƒ—ï¼‰ã‚’ä¸å¯§ã«ã€‚æ³¢ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã«åˆã‚ã›ã¦ã€æ¯ã®æµã‚Œã‚’æ­¢ã‚ãšã«ã€‚",
            TENOR: "ãƒ¡ãƒ­ãƒ‡ã‚£ã¨ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼ã®ä¸¡æ–¹ã‚’æ‹…å½“ã€‚**ãƒªã‚ºãƒ ã‚’æ„è­˜**ã—ã€å‰ã®ã‚ã‚Šã«ãªã‚‰ãªã„ã‚ˆã†æ³¨æ„ã€‚",
        },
        {
            measure: '9-12', dynamics: 'mf', tempo: 'Tempo I',
            lyrics: {
                SOPRANO: [{ text: "é’ã„æµ·åŸã«", time: 42.5 }, { text: "ç™½ã„å¸†ã‚’ã‚ã’ã¦", time: 47.1 }],
                ALTO:    [{ text: "é’ã„æµ·åŸã«", time: 42.5 }, { text: "ç™½ã„å¸†ã‚’ã‚ã’ã¦", time: 47.1 }],
                TENOR:   [{ text: "é’ã„æµ·åŸã«", time: 42.5 }, { text: "ç™½ã„å¸†ã‚’ã‚ã’ã¦", time: 47.1 }]
            },
            SOPRANO: "é–‹æ”¾æ„Ÿã®ã‚ã‚‹éŸ¿ãã€‚å­éŸ³ã‚’é‹­ãå‡ºã—ã™ããšã€**æ¯éŸ³ã®éŸ¿ãã‚’ä¿ã¤**ã€‚",
            ALTO: "å’Œå£°ãƒ‘ãƒ¼ãƒˆã¨ã—ã¦éŸ¿ãã‚’åºƒã’ã‚‹ã€‚**ã€Œé’ã„ã€ã®ã€Œã‚ã€ã®æ¯éŸ³ã‚’æ·±ã**ã€‚",
            TENOR: "å…¨ä½“ã‚’æ”¯ãˆã‚‹ä¸­ä½éŸ³ã€‚ãƒ•ãƒ¬ãƒ¼ã‚ºã®å¾ŒåŠã«å‘ã‹ã£ã¦å°‘ã—å‰é€²ã™ã‚‹æ„è­˜ã‚’æŒã¤ã€‚",
        },
        {
            measure: '13-16', dynamics: 'p', tempo: 'rit. poco',
            lyrics: {
                SOPRANO: [{ text: "é¢¨ã‚’æ„Ÿã˜ãŸã¨ã", time: 51.8 }, { text: "ã‚„ã•ã—ã•ã«æŠ±ã‹ã‚Œã‚‹", time: 56.1 }],
                ALTO:    [{ text: "é¢¨ã‚’æ„Ÿã˜ãŸã¨ã", time: 51.8 }, { text: "ã‚„ã•ã—ã•ã«æŠ±ã‹ã‚Œã‚‹", time: 56.1 }],
                TENOR:   [{ text: "é¢¨ã‚’æ„Ÿã˜ãŸã¨ã", time: 51.8 }, { text: "ã‚„ã•ã—ã•ã«æŠ±ã‹ã‚Œã‚‹", time: 56.1 }]
            },
            SOPRANO: "ã€Œã‚„ã•ã—ã•ã«ã€ã§ãƒ‡ã‚¯ãƒ¬ãƒƒã‚·ã‚§ãƒ³ãƒ‰ã€‚**é¢¨ãŒé€šã‚Šéãã‚‹ã‚ˆã†ã«**æŸ”ã‚‰ã‹ãéŸ³é‡ã‚’çµã‚‹ã€‚",
            ALTO: "ã€ŒæŠ±ã‹ã‚Œã‚‹ã€ã®ã€Œã‚Œã€ã‚’ä¸å¯§ã«ä¼¸ã°ã—ã€**æœ€å¾Œã¯ãã£ã¨æ¯ã‚’é€ƒã™**ã‚ˆã†ã«éŸ³ã‚’åˆ‡ã‚‹ã€‚",
            TENOR: "ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼ã®å¤‰åŒ–ã‚’æ„Ÿã˜ãªãŒã‚‰ã€**å…¨ä½“ã‚’åŒ…ã¿è¾¼ã‚€ã‚ˆã†ãªæ¸©ã‹ã„å£°**ã‚’æ„è­˜ã€‚",
        },
        {
            measure: '17-20', dynamics: 'cresc.', tempo: 'Meno mosso',
            lyrics: {
                SOPRANO: [{ text: "ç©ºã‚’ç„¦ãŒã—", time: 62.1 }, { text: "æ˜‡ã‚‹å¤ªé™½", time: 66.3 }],
                ALTO:    [{ text: "ç©ºã‚’ç„¦ãŒã—", time: 62.1 }, { text: "æ˜‡ã‚‹å¤ªé™½", time: 66.3 }],
                TENOR:   [{ text: "ç©ºã‚’ç„¦ãŒã—", time: 62.1 }, { text: "æ˜‡ã‚‹å¤ªé™½", time: 66.3 }]
            },
            SOPRANO: "**ãƒ‰ãƒ©ãƒãƒãƒƒã‚¯ã«**ã€‚å¤ªé™½ãŒã‚†ã£ãã‚Šæ˜‡ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã€ç„¦ã‚‰ãšéŸ¿ãã‚’é‡ã­ã‚‹ã€‚",
            ALTO: "ä½éŸ³åŸŸã ãŒå£°ã‚’æ½°ã•ãšã€**æ·±ã„éŸ¿ãã§å¼·å¼±ã‚’èª¿æ•´**ã€‚ã€Œå¤ªé™½ã€ã§åŠ›ã‚’ãŸã‚ã‚‹ã€‚",
            TENOR: "é™ã‹ã ãŒå¼·ã„æ„å¿—ã‚’æŒã¤ã€‚**ã‚¯ãƒ¬ãƒƒã‚·ã‚§ãƒ³ãƒ‰ã®èµ·ç‚¹**ã¨ãªã‚Šã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’è“„ç©ã€‚",
        },
        {
            measure: '21-24', dynamics: 'f', tempo: 'A Tempo',
            lyrics: {
                SOPRANO: [{ text: "æ†§ã‚Œã‚ˆã‚Šã‚‚", time: 71.0 }, { text: "ã‚‚ã£ã¨é ãã«è¦‹ãˆã‚‹", time: 74.0 }],
                ALTO:    [{ text: "æ†§ã‚Œã‚ˆã‚Šã‚‚", time: 71.0 }, { text: "ã‚‚ã£ã¨é ãã«è¦‹ãˆã‚‹", time: 74.0 }],
                TENOR:   [{ text: "æ†§ã‚Œã‚ˆã‚Šã‚‚", time: 71.0 }, { text: "ã‚‚ã£ã¨é ãã«è¦‹ãˆã‚‹", time: 74.0 }]
            },
            SOPRANO: "æ†§ã‚Œã‚’è¿½ã„ã‹ã‘ã‚‹å¼·ã„æ°—æŒã¡ã€‚**æ˜ã‚‹ãã€çªãæŠœã‘ã‚‹ã‚ˆã†ãªé«˜éŸ³**ã€‚å¼·å¼±ã‚’ç¶­æŒã€‚",
            ALTO: "ã€Œé ãã€ã®éŸ¿ãã‚’å¤§åˆ‡ã«ã€‚**éŸ¿ãã‚’å¾Œã‚ã«å¼•ã‹ãªã„**ã‚ˆã†ã€å¸¸ã«å‰ã¸ã€‚",
            TENOR: "é«˜æšæ„Ÿã‚’ä¿ã¡ã¤ã¤ã€é«˜éŸ³ã®éŸ¿ãã‚’é‚ªé­”ã—ãªã„ã‚ˆã†ã€**æ”¯ãˆã‚‹åŠ›å¼·ã„éŸ¿ã**ã‚’ã€‚",
        },
        {
            measure: '25-28', dynamics: 'dim.', tempo: 'Tempo I',
            lyrics: {
                SOPRANO: [{ text: "å¤¢ã®ç ´ç‰‡(ã‹ã‘ã‚‰)", time: 78.1 }, { text: "æ¢ã—ã«è¡Œã", time: 80.5 }, { text: "æœãŒæ¥ãŸã‚ˆ", time: 83.2 }],
                ALTO:    [{ text: "å¤¢ã®ç ´ç‰‡(ã‹ã‘ã‚‰)", time: 78.1 }, { text: "æ¢ã—ã«è¡Œã", time: 80.5 }, { text: "æœãŒæ¥ãŸã‚ˆ", time: 83.2 }],
                TENOR:   [{ text: "å¤¢ã®ç ´ç‰‡(ã‹ã‘ã‚‰)", time: 78.1 }, { text: "æ¢ã—ã«è¡Œã", time: 80.5 }, { text: "æœãŒæ¥ãŸã‚ˆ", time: 83.2 }]
            },
            SOPRANO: "ã€ŒæœãŒæ¥ãŸã‚ˆã€ã®ã€Œã‚ˆã€ã‚’**é•·ãä¼¸ã°ã—**ã€ãƒ‡ã‚¯ãƒ¬ãƒƒã‚·ã‚§ãƒ³ãƒ‰ã—ãªãŒã‚‰æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¸ç¹‹ãã€‚",
            ALTO: "**è¨€è‘‰ã®è¼ªéƒ­ã‚’æ˜ç­ã«**ã€‚å‰ã®ã‚ã‚Šã«ãªã‚‰ãšã€ãƒ†ãƒ³ãƒã‚’æ­£ç¢ºã«ã€‚ã‚½ãƒ—ãƒ©ãƒã¨ã®éŸ¿ãã‚’èª¿æ•´ã€‚",
            TENOR: "**å¼·ã•ã®ä¸­ã«ã‚‚å„ªã—ã•**ã‚’è¡¨ç¾ã™ã‚‹ã€‚ã€ŒæœãŒæ¥ãŸã‚ˆã€ã¯å°‘ã—ãšã¤éŸ³ã‚’çµã‚Šå§‹ã‚ã‚‹ã€‚",
        },
        {
            measure: '29-32', dynamics: 'mp', tempo: 'Andante',
            lyrics: {
                SOPRANO: [{ text: "æ˜¥ã«ã¯æ˜¥ã®", time: 89.1 }, { text: "èŠ±ãŒå’²ãã»ã“ã‚Š", time: 93.0 }],
                ALTO:    [{ text: "æ˜¥ã«ã¯æ˜¥ã®", time: 89.1 }, { text: "èŠ±ãŒå’²ãã»ã“ã‚Š", time: 93.0 }],
                TENOR:   [{ text: "æ˜¥ã«ã¯æ˜¥ã®", time: 89.1 }, { text: "èŠ±ãŒå’²ãã»ã“ã‚Š", time: 93.0 }]
            },
            SOPRANO: "ç©ã‚„ã‹ãªæµã‚Œã€‚**ã€Œã¯ã‚‹ã€ã‚’å„ªã—ã**ç™ºéŸ³ã—ã€éŸ¿ãã¯æŸ”ã‚‰ã‹ãã€ä¸¸ãã€‚",
            ALTO: "ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼ã‚’è±Šã‹ã«å½©ã‚‹ã€‚**ã€Œã»ã“ã‚Šã€ã®çµ‚ç«¯ã‚’ãã‚Œã„ã«åˆ‡ã‚‹**ã€‚",
            TENOR: "**ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ©ã‚¤ãƒ³ã‚’ä¸å¯§ã«**æ­Œã„ã€å’Œå£°ã®æµã‚Œã‚’æ­£ç¢ºã«è¡¨ç¾ã€‚",
        },
        {
            measure: '33-36', dynamics: 'f', tempo: 'A Tempo',
            lyrics: {
                SOPRANO: [{ text: "å¤ã«ã¯å¤ã®", time: 98.2 }, { text: "é³¥ãŒèˆã†ã‚ˆ", time: 102.0 }, { text: "å¤§ç©ºé«˜ã", time: 104.5 }],
                ALTO:    [{ text: "å¤ã«ã¯å¤ã®", time: 98.2 }, { text: "é³¥ãŒèˆã†ã‚ˆ", time: 102.0 }, { text: "å¤§ç©ºé«˜ã", time: 104.5 }],
                TENOR:   [{ text: "å¤ã«ã¯å¤ã®", time: 98.2 }, { text: "é³¥ãŒèˆã†ã‚ˆ", time: 102.0 }, { text: "å¤§ç©ºé«˜ã", time: 104.5 }]
            },
            SOPRANO: "ã€Œå¤§ç©ºé«˜ãã€ã§**éŸ³ã‚’è§£æ”¾ã—ã€è¼ã‹ã›ã‚‹**ã€‚ã‚¯ãƒ¬ãƒƒã‚·ã‚§ãƒ³ãƒ‰ã¨ãƒªã‚¿ãƒ«ãƒ€ãƒ³ãƒ‰ã«åˆã‚ã›ã‚‹ã€‚",
            ALTO: "ã€Œèˆã†ã‚ˆã€ã®é«˜éŸ³ã‚’æŸ”ã‚‰ã‹ãã€‚ã‚½ãƒ—ãƒ©ãƒã¨å…±ã«**é–‹æ”¾æ„Ÿã‚’æ¼”å‡º**ã€‚",
            TENOR: "ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼ã®å¤‰åŒ–ãŒç¾ã—ã„éƒ¨åˆ†ã€‚**éŸ¿ãã‚’ç«‹ä½“çš„ã«**ä½œã‚‹æ„è­˜ã€‚",
        },
        {
            measure: '37-40', dynamics: 'p', tempo: 'Lento',
            lyrics: {
                SOPRANO: [{ text: "ã‚‚ã—ã‚‚ãã¿ãŒ", time: 108.0 }, { text: "ã„ã¤ã®æ—¥ã«ã‹", time: 111.0 }, { text: "ã²ã¨ã‚Šã¼ã£ã¡ã ã¨", time: 114.5 }],
                ALTO:    [{ text: "ã‚‚ã—ã‚‚ãã¿ãŒ", time: 108.0 }, { text: "ã„ã¤ã®æ—¥ã«ã‹", time: 111.0 }, { text: "ã²ã¨ã‚Šã¼ã£ã¡ã ã¨", time: 114.5 }],
                TENOR:   [{ text: "ã‚‚ã—ã‚‚ãã¿ãŒ", time: 108.0 }, { text: "ã„ã¤ã®æ—¥ã«ã‹", time: 111.0 }, { text: "ã²ã¨ã‚Šã¼ã£ã¡ã ã¨", time: 114.5 }]
            },
            SOPRANO: "**èªã‚Šã‹ã‘ã‚‹ã‚ˆã†ã«**ã€å¼±ã„éŸ³é‡ã§ä¸å¯§ã«æ­Œã†ã€‚ä¸€è¨€ä¸€è¨€ã«å¿ƒã‚’è¾¼ã‚ã‚‹ã€‚",
            ALTO: "ãƒ¡ãƒ­ãƒ‡ã‚£ã‚’æ”¯ãˆã‚‹ã€‚**å¯‚ã—ã•ã‚„ä¸å®‰**ã‚’è¡¨ç¾ã™ã‚‹ãŸã‚ã€éŸ¿ãã‚’æŠ‘ãˆã‚‹ã€‚",
            TENOR: "**å­¤ç‹¬æ„Ÿ**ã‚’è¡¨ç¾ã€‚å„ªã—ã„éŸ³è‰²ã ãŒã€ä¸å®‰å®šã«ãªã‚‰ãªã„ã‚ˆã†èŠ¯ã‚’ä¿ã¤ã€‚",
        },
        {
            measure: '41-44', dynamics: 'cresc.', tempo: 'Espressivo',
            lyrics: {
                SOPRANO: [{ text: "ã‚ã’ãã†ãªå¤œãŒã‚ã£ãŸã¨ã—ã¦ã‚‚", time: 118.5 }],
                ALTO:    [{ text: "ã‚ã’ãã†ãªå¤œãŒã‚ã£ãŸã¨ã—ã¦ã‚‚", time: 118.5 }],
                TENOR:   [{ text: "ã‚ã’ãã†ãªå¤œãŒã‚ã£ãŸã¨ã—ã¦ã‚‚", time: 118.5 }]
            },
            SOPRANO: "å„ªã—ãåŒ…ã¿è¾¼ã‚€æ¸©ã‹ã•ã€‚**ã€Œå¤œã€ã®ä¼¸ã°ã™éŸ³ã‚’å¤§åˆ‡ã«**ã€‚ã‚ãšã‹ã«ã‚¯ãƒ¬ãƒƒã‚·ã‚§ãƒ³ãƒ‰ã€‚",
            ALTO: "ã‚½ãƒ—ãƒ©ãƒã¨**å¯„ã‚Šæ·»ã†**ã‚ˆã†ãªéŸ¿ãã€‚ãƒ•ãƒ¬ãƒ¼ã‚ºã®æœ€å¾Œã¯ãã£ã¨åæŸã€‚",
            TENOR: "ä¸å®‰å®šãªå’Œå£°æ„Ÿã€‚**æ„Ÿæƒ…ã‚’è¾¼ã‚ã¦**æ­Œã„ã€æ¬¡ã®å­£ç¯€ã®æå†™ã¸ç¹‹ãã€‚",
        },
        {
            measure: '45-48', dynamics: 'mp', tempo: 'Tempo I',
            lyrics: {
                SOPRANO: [{ text: "ç§‹ã«ã¯ç§‹ã®", time: 127.8 }, { text: "æ˜ŸãŒç¬ã„ã¦", time: 131.8 }],
                ALTO:    [{ text: "ç§‹ã«ã¯ç§‹ã®", time: 127.8 }, { text: "æ˜ŸãŒç¬ã„ã¦", time: 131.8 }],
                TENOR:   [{ text: "ç§‹ã«ã¯ç§‹ã®", time: 127.8 }, { text: "æ˜ŸãŒç¬ã„ã¦", time: 131.8 }]
            },
            SOPRANO: "**æ˜Ÿã®è¼ã**ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚ä¸€ã¤ä¸€ã¤ã®éŸ³ã‚’**ã‚¯ãƒªã‚¢ã«ç™ºéŸ³**ã—ã€éŸ¿ãã‚’ä¿ã¤ã€‚",
            ALTO: "ç©ã‚„ã‹ã§å®‰å®šã—ãŸéŸ¿ãã€‚**æ‹ã®é ­ã‚’ä¸å¯§ã«**æ‰±ã†ã€‚",
            TENOR: "æ¸©ã‹ãæŸ”ã‚‰ã‹ã„éŸ³è‰²ã€‚**ä½éŸ³ãƒ‘ãƒ¼ãƒˆã¨ã®èª¿å’Œ**ã‚’æ„è­˜ã€‚",
        },
        {
            measure: '49-52', dynamics: 'dim.', tempo: 'rall.',
            lyrics: {
                SOPRANO: [{ text: "å†¬ã«ã¯å†¬ã®", time: 137.2 }, { text: "é›ªãŒé ¬ã§æº¶ã‘ã¦ã„ãã‚ˆã«", time: 141.0 }],
                ALTO:    [{ text: "å†¬ã«ã¯å†¬ã®", time: 137.2 }, { text: "é›ªãŒé ¬ã§æº¶ã‘ã¦ã„ãã‚ˆã«", time: 141.0 }],
                TENOR:   [{ text: "å†¬ã«ã¯å†¬ã®", time: 137.2 }, { text: "é›ªãŒé ¬ã§æº¶ã‘ã¦ã„ãã‚ˆã«", time: 141.0 }]
            },
             SOPRANO: "**ã€Œæº¶ã‘ã¦ã„ãã€ã®æ§˜å­ã‚’éŸ³é‡ã¨ãƒ†ãƒ³ãƒã§è¡¨ç¾**ã€‚éå¸¸ã«ç¹Šç´°ã«éŸ³ã‚’çµã‚‹ã€‚",
            ALTO: "ã‚½ãƒ—ãƒ©ãƒã¨å…±ã«å™æƒ…çš„ã«ã€‚**ãƒ‡ã‚¯ãƒ¬ãƒƒã‚·ã‚§ãƒ³ãƒ‰ãŒéµ**ã€‚æ¯ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’ä¸€å®šã«ä¿ã¤ã€‚",
            TENOR: "ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼ã®ç·Šå¼µæ„Ÿã‚’ç¶­æŒã—ã¤ã¤ã€**å„ªã—ãè§£æ”¾**ã€‚ã€Œã„ãã‚ˆã«ã€ã¯ã—ã£ã‹ã‚Šä¼¸ã°ã™ã€‚",
        },
        {
            measure: '53-56', dynamics: 'cresc.', tempo: 'accel.',
            lyrics: {
                SOPRANO: [{ text: "ã„ã¤ã ã£ã¦", time: 148.8 }, { text: "ãã°ã«ã„ã‚‹ã‚ˆ", time: 151.2 }],
                ALTO:    [{ text: "ã„ã¤ã ã£ã¦", time: 148.8 }, { text: "ãã°ã«ã„ã‚‹ã‚ˆ", time: 151.2 }],
                TENOR:   [{ text: "ã„ã¤ã ã£ã¦", time: 148.8 }, { text: "ãã°ã«ã„ã‚‹ã‚ˆ", time: 151.2 }]
            },
            SOPRANO: "å¼·ã„æ±ºæ„ã‚’è¾¼ã‚ãŸ**æ¸©ã‹ã„è¨€è‘‰**ã€‚ã‚¯ãƒ¬ãƒƒã‚·ã‚§ãƒ³ãƒ‰ã§ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹ã¸å‘ã‹ã†ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’å‡ºã™ã€‚",
            ALTO: "ã‚½ãƒ—ãƒ©ãƒã®éŸ¿ãã‚’ã€**ä¸‹ã‹ã‚‰ã—ã£ã‹ã‚Šã¨æ”¯ãˆã‚‹**ã€‚ãƒªã‚ºãƒ ã®åŠ é€Ÿæ„Ÿã‚’æ„è­˜ã€‚",
            TENOR: "ã€Œã„ã‚‹ã‚ˆã€ã®**å­éŸ³ã‚’ç«‹ãŸã›**ã€èª¬å¾—åŠ›ã®ã‚ã‚‹å£°ã€‚æœ€å¤§ã®ç››ã‚Šä¸ŠãŒã‚Šã«å‚™ãˆã‚‹ã€‚",
        },
        {
            measure: '57-62', dynamics: 'fff', tempo: 'Maestoso',
            lyrics: {
                SOPRANO: [{ text: "ãã£ã¨åŒ…ã¿è¾¼ã‚€", time: 154.5 }, { text: "åœ°çƒã®", time: 158.5 }, { text: "é¼“å‹•ãŒèã“ãˆã¦ãã‚‹ã ã‚ã†", time: 161.0 }],
                ALTO:    [{ text: "ãã£ã¨åŒ…ã¿è¾¼ã‚€", time: 154.5 }, { text: "åœ°çƒã®", time: 158.5 }, { text: "é¼“å‹•ãŒèã“ãˆã¦ãã‚‹ã ã‚ã†", time: 161.0 }],
                TENOR:   [{ text: "ãã£ã¨åŒ…ã¿è¾¼ã‚€", time: 154.5 }, { text: "åœ°çƒã®", time: 158.5 }, { text: "é¼“å‹•ãŒèã“ãˆã¦ãã‚‹ã ã‚ã†", time: 161.0 }]
            },
            SOPRANO: "æ›²ã®**ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹**ã€‚æœ€å¤§ã®éŸ³é‡ã§ã€**é ­ä¸Šã®éŸ¿ã**ã‚’æ„è­˜ã€‚æœ€å¾Œã®ã€Œã†ã€ã‚’é•·ãä¼¸ã°ã™ã€‚",
            ALTO: "å’Œå£°ã®ä¸­ã§æœ€ã‚‚**ã‚¨ãƒ¢ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãªéŸ¿ã**ã‚’ã€‚éŸ³é‡ã«è² ã‘ãšã€éŸ³ç¨‹ã‚’ä¿æŒã€‚",
            TENOR: "**ãƒ†ãƒãƒ¼ãƒ«ãŒæŒã¤æœ€å¤§ã®åŠ›**ã¨ã€ç¾ã—ã„éŸ³è‰²ã‚’ä¸¡ç«‹ã€‚å’Œå£°ã®åšã¿ã‚’å‡ºã™ã€‚",
        },
    ];
    
    // å…¨éŸ³æº(ç´„3åˆ†2ç§’)ã«åˆã‚ã›ãŸåŒæœŸãƒã‚¤ãƒ³ãƒˆ
    const SYNC_POINTS = [
        { step: 0, time: 23.0 }, { step: 1, time: 32.5 }, { step: 2, time: 42.0 }, 
        { step: 3, time: 51.5 }, { step: 4, time: 62.0 }, { step: 5, time: 70.8 }, 
        { step: 6, time: 77.9 }, { step: 7, time: 88.9 }, { step: 8, time: 98.0 }, 
        { step: 9, time: 107.8 }, { step: 10, time: 118.3 }, { step: 11, time: 127.6 }, 
        { step: 12, time: 137.0 }, { step: 13, time: 148.6 }, { step: 14, time: 154.3 }, 
        { step: 15, time: 300.0 } // End
    ];

    // =================================================================
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨DOMè¦ç´ 
    // =================================================================
    let currentStep = 0;
    let selectedPart = 'SOPRANO';
    const totalSteps = CHORUS_DATA.length;
    let isSyncing = true;
    let lastHighlightedIndex = -1;

    const getEl = id => document.getElementById(id);
    const audioElement = getEl('chorus-audio');
    const partButtons = document.querySelectorAll('.part-button');
    const currentLyrics = getEl('current-lyrics');
    // ... ä»–ã®DOMè¦ç´  ...
    
    // =================================================================
    // ä¸»è¦ãªãƒ­ã‚¸ãƒƒã‚¯
    // =================================================================
    function updateDisplay(isStepChange = false) {
        if (currentStep < 0 || currentStep >= totalSteps) return;

        const data = CHORUS_DATA[currentStep];
        const partColorMap = { SOPRANO: 'primary-red', ALTO: 'primary-yellow', TENOR: 'primary-green' };
        const activeColor = partColorMap[selectedPart];

        if (isStepChange) {
            const partLyrics = data.lyrics[selectedPart];
            currentLyrics.innerHTML = partLyrics.map((word, index) => {
                const isRest = word.text.includes('(Rest)');
                return `<span class="lyric-word ${isRest ? 'rest' : ''}" data-index="${index}">${word.text}</span>`;
            }).join(' ');
            lastHighlightedIndex = -1;
        }

        updateIndicators(data, activeColor);
        
        getEl('part-instruction').innerHTML = `<span class="font-extrabold text-${activeColor}">${selectedPart}</span>: ${data[selectedPart]}`;
        getEl('instruction-area').className = `mt-8 p-4 rounded-xl border-2 border-dashed border-${activeColor}-400 bg-${activeColor}-50 min-h-[100px] flex items-center justify-center`;

        getEl('measure-number').textContent = `å°ç¯€: ${data.measure}`;
        getEl('progress-bar').style.width = `${((currentStep + 1) / totalSteps) * 100}%`;
        getEl('progress-bar').className = `h-2 rounded-full bg-${activeColor} transition-all duration-300`;
        getEl('progress-text').textContent = `${currentStep + 1} / ${totalSteps}`;
        
        getEl('prev-btn').disabled = isSyncing ? true : currentStep === 0;
        getEl('next-btn').disabled = isSyncing ? true : currentStep === totalSteps - 1;
        getEl('next-btn').className = `flex-1 px-6 py-3 text-white font-bold rounded-xl transition disabled:opacity-50 bg-${activeColor} hover:bg-${activeColor}-600`;
    }

    function updateIndicators(data, color) {
        const dynamicsData = MUSIC_GLOSSARY[data.dynamics] || {};
        getEl('current-dynamics-symbol').textContent = data.dynamics;
        getEl('current-dynamics-meaning').textContent = dynamicsData.meaning || '-';
        getEl('current-dynamics-symbol').className = `font-black transition-transform duration-300 ${dynamicsData.size || 'text-6xl'}`;
        getEl('dynamics-card').className = `p-4 rounded-xl text-center border-2 border-${color}-400 bg-${color}-50`;
        getEl('current-dynamics-symbol').style.transform = `scale(${1 + (Object.keys(MUSIC_GLOSSARY).indexOf(data.dynamics) / 20)})`;
        
        const tempoData = MUSIC_GLOSSARY[data.tempo] || { meaning: data.tempo };
        getEl('current-tempo-symbol').textContent = data.tempo;
        getEl('current-tempo-meaning').textContent = tempoData.meaning;
    }

    function handleTimeUpdate() {
        const currentTime = audioElement.currentTime;
        getEl('audio-slider').value = currentTime;
        getEl('current-time').textContent = formatTime(currentTime);

        if (isSyncing) {
            const nextSyncPoint = SYNC_POINTS.find(p => p.step === currentStep + 1);
            if (nextSyncPoint && currentTime >= nextSyncPoint.time) {
                currentStep++;
                updateDisplay(true);
            }
        }

        const partLyrics = CHORUS_DATA[currentStep].lyrics[selectedPart];
        const lyricSpans = currentLyrics.querySelectorAll('.lyric-word');
        let highlightIndex = -1;
        for (let i = 0; i < partLyrics.length; i++) {
            if (currentTime >= partLyrics[i].time) {
                highlightIndex = i;
            } else {
                break;
            }
        }
        if (highlightIndex !== lastHighlightedIndex) {
            lyricSpans.forEach((span, index) => span.classList.toggle('highlight', index <= highlightIndex));
            lastHighlightedIndex = highlightIndex;
        }
    }
    
    function formatTime(seconds) {
        if (isNaN(seconds) || seconds < 0) return '0:00';
        const minutes = Math.floor(seconds / 60);
        return `${minutes}:${String(Math.floor(seconds % 60)).padStart(2, '0')}`;
    }

    function setupEventListeners() {
        partButtons.forEach(button => button.addEventListener('click', e => {
            selectedPart = e.currentTarget.getAttribute('data-part');
            partButtons.forEach(btn => btn.classList.remove('active-SOPRANO', 'active-ALTO', 'active-TENOR'));
            e.currentTarget.classList.add(`active-${selectedPart}`);
            updateDisplay(true);
        }));

        const navigate = (direction) => {
            if (!isSyncing) {
                currentStep = Math.max(0, Math.min(totalSteps - 1, currentStep + direction));
                updateDisplay(true);
                audioElement.currentTime = SYNC_POINTS[currentStep].time;
            }
        };
        getEl('prev-btn').addEventListener('click', () => navigate(-1));
        getEl('next-btn').addEventListener('click', () => navigate(1));

        getEl('sync-toggle-btn').addEventListener('click', e => {
            isSyncing = !isSyncing;
            e.target.textContent = `åŒæœŸ ${isSyncing ? 'ON' : 'OFF'}`;
            e.target.classList.toggle('bg-green-500', isSyncing);
            e.target.classList.toggle('bg-gray-500', !isSyncing);
            updateDisplay(true); // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
        });

        getEl('play-pause-btn').addEventListener('click', () => {
            if (audioElement.paused) audioElement.play();
            else audioElement.pause();
        });
        
        getEl('audio-source-select').addEventListener('change', e => {
            const wasPlaying = !audioElement.paused;
            audioElement.src = e.target.value;
            audioElement.load();
            if (wasPlaying) {
                audioElement.play();
            }
        });

        audioElement.addEventListener('loadedmetadata', () => {
            const duration = audioElement.duration;
            getEl('audio-slider').max = duration;
            getEl('duration').textContent = formatTime(duration);
        });
        audioElement.addEventListener('timeupdate', handleTimeUpdate);
        audioElement.addEventListener('play', () => { getEl('play-icon').classList.add('hidden'); getEl('pause-icon').classList.remove('hidden'); });
        audioElement.addEventListener('pause', () => { getEl('pause-icon').classList.add('hidden'); getEl('play-icon').classList.remove('hidden'); });
        audioElement.addEventListener('ended', () => { audioElement.currentTime = 0; currentStep = 0; updateDisplay(true); audioElement.pause(); });
        
        getEl('audio-slider').addEventListener('input', () => {
            const newTime = parseFloat(getEl('audio-slider').value);
            audioElement.currentTime = newTime;

            let closestStep = 0;
            for (let i = SYNC_POINTS.length - 1; i >= 0; i--) {
                if (newTime >= SYNC_POINTS[i].time) {
                    closestStep = i;
                    break;
                }
            }
            if (currentStep !== closestStep) {
                currentStep = closestStep;
                updateDisplay(true);
            }
        });
    }

    window.onload = () => {
        partButtons[0].classList.add('active-SOPRANO');
        updateDisplay(true);
        setupEventListeners();
        getEl('prev-btn').disabled = true;
        getEl('next-btn').disabled = true;
    };
</script>

</body>
</html>